<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="zichy">
	<meta name="description" content="Keep track of player's life points, poison counters, and commander damage in the trading card game Magic: The Gathering.">
	<title>kaunter - multiplayer</title>
	
	<!-- Firebase -->
	<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
	
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
			background: #1a1a1a;
			color: #fff;
			min-height: 100vh;
		}

		.game-id-section {
			background: #2a2a2a;
			padding: 20px;
			text-align: center;
			border-bottom: 2px solid #3a3a3a;
		}

		.game-id-section h2 {
			font-size: 1.2rem;
			margin-bottom: 10px;
		}

		.game-id-display {
			font-size: 2rem;
			font-weight: bold;
			letter-spacing: 0.5rem;
			color: #4CAF50;
			margin: 10px 0;
		}

		.game-controls {
			display: flex;
			gap: 10px;
			justify-content: center;
			flex-wrap: wrap;
			margin-top: 15px;
		}

		.game-controls button {
			padding: 10px 20px;
			font-size: 1rem;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-weight: bold;
			transition: all 0.2s;
		}

		.btn-primary {
			background: #4CAF50;
			color: white;
		}

		.btn-primary:hover {
			background: #45a049;
		}

		.btn-secondary {
			background: #2196F3;
			color: white;
		}

		.btn-secondary:hover {
			background: #0b7dda;
		}

		.btn-danger {
			background: #f44336;
			color: white;
		}

		.btn-danger:hover {
			background: #da190b;
		}

		.join-form {
			display: flex;
			gap: 10px;
			justify-content: center;
			align-items: center;
			margin-top: 15px;
		}

		.join-input {
			padding: 10px;
			font-size: 1rem;
			border: 2px solid #4CAF50;
			border-radius: 5px;
			background: #1a1a1a;
			color: white;
			text-transform: uppercase;
			letter-spacing: 0.2rem;
			width: 200px;
			text-align: center;
		}

		.content {
			padding: 20px;
			max-width: 1400px;
			margin: 0 auto;
		}

		.intro {
			text-align: center;
			margin-bottom: 40px;
		}

		.intro__headline {
			font-size: 3rem;
			margin-bottom: 20px;
			color: #4CAF50;
		}

		.intro__actions {
			margin-top: 30px;
		}

		.intro__label {
			font-size: 1.2rem;
			margin-bottom: 15px;
		}

		.intro__list {
			list-style: none;
			display: flex;
			gap: 15px;
			justify-content: center;
			flex-wrap: wrap;
		}

		.add-button {
			padding: 15px 30px;
			font-size: 1.1rem;
			background: #4CAF50;
			color: white;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-weight: bold;
			transition: all 0.2s;
		}

		.add-button:hover {
			background: #45a049;
			transform: scale(1.05);
		}

		.players-container {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
			gap: 20px;
			margin-top: 30px;
		}

		.player {
			background: #2a2a2a;
			border-radius: 10px;
			padding: 20px;
			border: 2px solid #3a3a3a;
		}

		.player__name {
			width: 100%;
			background: transparent;
			border: none;
			border-bottom: 2px solid #4CAF50;
			color: white;
			font-size: 1.5rem;
			padding: 10px;
			margin-bottom: 20px;
			text-align: center;
		}

		.player__delete {
			width: 100%;
			padding: 8px;
			background: #f44336;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			margin-bottom: 15px;
			font-weight: bold;
		}

		.player__delete:hover {
			background: #da190b;
		}

		.life {
			background: #1a1a1a;
			padding: 20px;
			border-radius: 8px;
			margin-bottom: 15px;
		}

		.life__input {
			width: 100%;
			font-size: 4rem;
			font-weight: bold;
			text-align: center;
			background: transparent;
			border: none;
			color: white;
			margin-bottom: 15px;
		}

		.life__button {
			width: 48%;
			padding: 15px;
			margin: 1%;
			font-size: 1.5rem;
			font-weight: bold;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			transition: all 0.2s;
		}

		.life__button--1, .life__button--3 {
			background: #f44336;
			color: white;
		}

		.life__button--1:hover, .life__button--3:hover {
			background: #da190b;
		}

		.life__button--2, .life__button--4 {
			background: #4CAF50;
			color: white;
		}

		.life__button--2:hover, .life__button--4:hover {
			background: #45a049;
		}

		.counter-group {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 10px;
		}

		.counter__item {
			background: #1a1a1a;
			border: 2px solid #3a3a3a;
			border-radius: 8px;
			padding: 15px;
		}

		.counter__legend {
			font-size: 1rem;
			font-weight: bold;
			margin-bottom: 10px;
			color: #4CAF50;
		}

		.counter__input {
			width: 100%;
			font-size: 2rem;
			font-weight: bold;
			text-align: center;
			background: transparent;
			border: none;
			color: white;
			margin-bottom: 10px;
		}

		.counter__button {
			width: 48%;
			margin: 1%;
			padding: 10px;
			font-size: 1rem;
			font-weight: bold;
			background: #2196F3;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}

		.counter__button:hover {
			background: #0b7dda;
		}

		.counter__reset {
			grid-column: 1 / -1;
			padding: 10px;
			background: #ff9800;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-weight: bold;
			margin-top: 10px;
		}

		.counter__reset:hover {
			background: #e68900;
		}

		.hidden {
			display: none;
		}

		@media (max-width: 768px) {
			.players-container {
				grid-template-columns: 1fr;
			}
		}
	</style>
</head>
<body>
	<div class="game-id-section" id="gameSection">
		<div id="lobbyView">
			<h1 class="intro__headline">kaunter</h1>
			<p style="margin-bottom: 20px;">Keep track of player's life points, poison counters, and commander damage in Magic: The Gathering.</p>
			
			<div class="game-controls">
				<button class="btn-primary" onclick="createGame()">Create New Game</button>
			</div>
			
			<div class="join-form">
				<input type="text" class="join-input" id="joinInput" placeholder="GAME ID" maxlength="6">
				<button class="btn-secondary" onclick="joinGame()">Join Game</button>
			</div>
		</div>

		<div id="gameView" class="hidden">
			<h2>Game ID: <span class="game-id-display" id="gameId"></span></h2>
			<p id="gameStatus"></p>
			<div class="game-controls">
				<button class="btn-secondary" onclick="copyGameId()">Copy Game ID</button>
				<button class="btn-danger" onclick="leaveGame()">Leave Game</button>
			</div>
		</div>
	</div>

	<div class="content">
		<div id="intro" class="intro hidden">
			<div class="intro__actions">
				<p class="intro__label">Add new player</p>
				<ul class="intro__list">
					<li class="intro__list-item">
						<button class="add-button" onclick="addPlayer(20)">
							<strong>20</strong> Life points
						</button>
					</li>
					<li class="intro__list-item">
						<button class="add-button" onclick="addPlayer(30)">
							<strong>30</strong> Life points
						</button>
					</li>
					<li class="intro__list-item">
						<button class="add-button" onclick="addPlayer(40)">
							<strong>40</strong> Life points
						</button>
					</li>
				</ul>
			</div>
		</div>

		<div class="players-container" id="playersContainer"></div>
	</div>

	<script>
		// Firebase configuration
		const firebaseConfig = {
			apiKey: "AIzaSyBHKyMN1xN-MjlIjCQQfDxcSMz3N1Ya120",
			authDomain: "mtg-life-counter-89b30.firebaseapp.com",
			databaseURL: "https://mtg-life-counter-89b30-default-rtdb.firebaseio.com",
			projectId: "mtg-life-counter-89b30",
			storageBucket: "mtg-life-counter-89b30.firebasestorage.app",
			messagingSenderId: "378955194548",
			appId: "1:378955194548:web:52e96ef1abef268ea1f7e1",
			measurementId: "G-3QSGWRMQJ4"
		};

		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
		const database = firebase.database();

		let currentGameId = null;
		let gameListener = null;

		function generateGameId() {
			return Math.random().toString(36).substring(2, 8).toUpperCase();
		}

		function createGame() {
			currentGameId = generateGameId();
			const gameData = {
				players: {},
				createdAt: Date.now()
			};

			database.ref('games/' + currentGameId).set(gameData).then(() => {
				showGameView();
				listenToGame();
			});
		}

		function joinGame() {
			const input = document.getElementById('joinInput');
			const gameId = input.value.trim().toUpperCase();

			if (gameId.length !== 6) {
				alert('Please enter a valid 6-character game ID');
				return;
			}

			database.ref('games/' + gameId).once('value').then((snapshot) => {
				if (snapshot.exists()) {
					currentGameId = gameId;
					showGameView();
					listenToGame();
				} else {
					alert('Game not found!');
				}
			});
		}

		function showGameView() {
			document.getElementById('lobbyView').classList.add('hidden');
			document.getElementById('gameView').classList.remove('hidden');
			document.getElementById('intro').classList.remove('hidden');
			document.getElementById('gameId').textContent = currentGameId;
			document.getElementById('gameStatus').textContent = 'Connected';
		}

		function leaveGame() {
			if (gameListener) {
				database.ref('games/' + currentGameId).off('value', gameListener);
			}
			currentGameId = null;
			document.getElementById('lobbyView').classList.remove('hidden');
			document.getElementById('gameView').classList.add('hidden');
			document.getElementById('intro').classList.add('hidden');
			document.getElementById('playersContainer').innerHTML = '';
		}

		function copyGameId() {
			navigator.clipboard.writeText(currentGameId);
			alert('Game ID copied to clipboard!');
		}

		function listenToGame() {
			const gameRef = database.ref('games/' + currentGameId);
			
			gameListener = gameRef.on('value', (snapshot) => {
				if (snapshot.exists()) {
					const gameData = snapshot.val();
					renderPlayers(gameData.players || {});
				}
			});
		}

		function addPlayer(life) {
			if (!currentGameId) return;

			const playerId = 'player_' + Date.now();
			const playerData = {
				name: 'Player ' + (Object.keys(getPlayers()).length + 1),
				life: life,
				poison: 0,
				commander: 0
			};

			database.ref('games/' + currentGameId + '/players/' + playerId).set(playerData);
		}

		function getPlayers() {
			return new Promise((resolve) => {
				database.ref('games/' + currentGameId + '/players').once('value').then((snapshot) => {
					resolve(snapshot.val() || {});
				});
			});
		}

		function updatePlayer(playerId, field, value) {
			if (!currentGameId) return;
			database.ref('games/' + currentGameId + '/players/' + playerId + '/' + field).set(value);
		}

		function deletePlayer(playerId) {
			if (!currentGameId) return;
			if (confirm('Remove this player?')) {
				database.ref('games/' + currentGameId + '/players/' + playerId).remove();
			}
		}

		function resetPlayer(playerId, initialLife) {
			if (!currentGameId) return;
			database.ref('games/' + currentGameId + '/players/' + playerId).update({
				life: initialLife,
				poison: 0,
				commander: 0
			});
		}

		function renderPlayers(players) {
			const container = document.getElementById('playersContainer');
			container.innerHTML = '';

			Object.entries(players).forEach(([playerId, player]) => {
				const playerDiv = document.createElement('article');
				playerDiv.className = 'player';
				playerDiv.innerHTML = `
					<input class="player__name" type="text" value="${player.name}" 
						onchange="updatePlayer('${playerId}', 'name', this.value)">
					<button class="player__delete" onclick="deletePlayer('${playerId}')">Remove</button>
					
					<div class="life">
						<input class="life__input" type="number" value="${player.life}" readonly>
						<button class="life__button life__button--1" onclick="updatePlayer('${playerId}', 'life', ${player.life - 1})">-1</button>
						<button class="life__button life__button--2" onclick="updatePlayer('${playerId}', 'life', ${player.life + 1})">+1</button>
						<button class="life__button life__button--3" onclick="updatePlayer('${playerId}', 'life', ${player.life - 5})">-5</button>
						<button class="life__button life__button--4" onclick="updatePlayer('${playerId}', 'life', ${player.life + 5})">+5</button>
					</div>
					
					<div class="counter-group">
						<fieldset class="counter__item">
							<legend class="counter__legend"><abbr title="Poison counters">Poison</abbr></legend>
							<input class="counter__input" type="number" value="${player.poison}" readonly>
							<button class="counter__button" onclick="updatePlayer('${playerId}', 'poison', Math.min(10, ${player.poison + 1}))">+1</button>
							<button class="counter__button" onclick="updatePlayer('${playerId}', 'poison', Math.max(0, ${player.poison - 1}))">-1</button>
						</fieldset>
						<fieldset class="counter__item">
							<legend class="counter__legend"><abbr title="Commander damage">Commander</abbr></legend>
							<input class="counter__input" type="number" value="${player.commander}" readonly>
							<button class="counter__button" onclick="updatePlayer('${playerId}', 'commander', Math.min(21, ${player.commander + 1}))">+1</button>
							<button class="counter__button" onclick="updatePlayer('${playerId}', 'commander', Math.max(0, ${player.commander - 1}))">-1</button>
						</fieldset>
						<button class="counter__reset" type="button" onclick="resetPlayer('${playerId}', ${player.life})">Reset</button>
					</div>
				`;
				container.appendChild(playerDiv);
			});
		}
	</script>
</body>
</html>
